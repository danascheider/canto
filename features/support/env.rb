# Generated by cucumber-sinatra. (2014-06-27 15:36:37 -0700)

require 'simplecov'
require 'coveralls'

SimpleCov.formatter = SimpleCov::Formatter::MultiFormatter[
  SimpleCov::Formatter::HTMLFormatter,
  Coveralls::SimpleCov::Formatter
]
SimpleCov.start if ENV["COVERAGE"]

ENV['RACK_ENV'] = 'test'

require File.expand_path('../../../lib/tessitura.rb', __FILE__)

require 'rspec'
require 'capybara/cucumber'
require 'capybara/webkit'
require 'json_spec/cucumber'
require 'rack/test'
require 'base64'
require 'date'

class String
  def to_date
    s = self.split(/\-/).map(&:to_i)
    Date.new(s[0],s[1],s[2]) rescue nil
  end
end

class TessituraWorld
  include RSpec::Expectations
  include RSpec::Matchers
  include RSpec::Mocks
  include Rack::Test::Methods
  include JsonSpec

  def app
    Tessitura.new
  end

  def last_json
    page.source
  end

  Capybara.app = Tessitura.new
  Capybara.javascript_driver = :webkit
end

World do
  TessituraWorld.new
end
